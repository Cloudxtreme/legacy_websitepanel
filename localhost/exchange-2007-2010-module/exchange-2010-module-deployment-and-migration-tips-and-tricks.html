<!DOCTYPE html> 
<html lang="en" class="static orchard-blogs"> 

<!-- Mirrored from localhost/exchange-2007-2010-module/exchange-2010-module-deployment-and-migration-tips-and-tricks by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 12 Nov 2013 18:59:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head> 
    <meta charset="utf-8" />
    <title>Exchange 2010 module deployment and migration tips and tricks - WebsitePanel</title> 
    <link href="../Modules/Orchard.Localization/Styles/orchard-localization-base.css" rel="stylesheet" type="text/css" />
<link href="../Themes/WebsitePanel/Styles/Site.css" rel="stylesheet" type="text/css" />
<meta content="Orchard" name="generator" />
<link href="../modules/orchard.themes/Content/orchard.ico" rel="shortcut icon" type="image/x-icon" />
<link href="http://fonts.googleapis.com/css?family=Lobster&amp;subset=latin" rel="stylesheet" type="text/css" />
<script src="../Core/Shapes/scripts/html5.js" type="text/javascript"></script>

<link rel="alternate" type="application/rss+xml" title="Exchange 2007/2010 Module" href="../rss68ec?containerid=101" />

<link rel="alternate" type="application/rss+xml" title="Exchange 2007/2010 Module - Comments" href="../rssba67?commentedoncontainer=101" />

    <script>(function(d){d.className="dyn"+d.className.substring(6,d.className.length);})(document.documentElement);</script> 
</head> 
<body>


<div class="split-4" id="layout-wrapper">
<header id="layout-header" class="group">
    <div id="header">
        <div class="zone zone-header"><h1 id="branding"><a href="../index.html" title="WebsitePanel"></a></h1>

<div id="search">
    <form action="http://localhost/search">
        <input type="text" name="q" />
        <input type="submit" id="search" value="Search" />
    </form>
</div></div>
    </div>
</header>
<div id="layout-navigation" class="group">
    <div class="zone zone-navigation"><nav>
    <ul class="menu menu-main">
        
        <li>    <a href="../index.html">Home</a>
</li><li>    <a href="../whatsnew.html">What&#39;s new?</a>
</li><li>    <a href="../license.html">License</a>
</li><li>    <a href="../downloads.html">Downloads</a>
</li><li>    <a href="../demo.html">Demo</a>
</li><li>    <a href="../documentation.html">Documentation</a>
</li><li>    <a href="../works-with.html">Works With</a>
</li><li>    <a href="../contact-us.html">Contact Us</a>
</li>
    </ul>
</nav></div>
</div>
<div id="layout-before-main" class="group">
    <div class="zone zone-before-main"><article class="widget-html-widget widget">
    <p><a href="../documentation.html">Documentation</a> &gt;&nbsp;<a href="index.html">Exchange 2007/2010 Modules</a></p>
</article></div>
</div>
<div id="layout-main-container">
<div id="layout-main" class="group">
    <div id="layout-content" class="group">
        <div id="content" class="group">
            <div class="zone zone-content"><article class="content-item blog-post">
    <header>
        <h1>Exchange 2010 module deployment and migration tips and tricks</h1>

        <div class="metadata">
            
        </div>
    </header>
    <div class="content-localization">
    <div class="content-localizations">
        <h4>Translations:</h4>
        <ul class="localizations"><li class="first last"><a href="exchange-2010-module-deployment-and-migration-tips-and-tricks-tr-TR.html">tr-TR</a></li></ul>
    </div>
</div>
<p><a name="Section1"></a> <h2>1. Group name change.</h2> <p>Use Exchange 2010 "Organization Management" AD group for WSP Servers application pools accounts on Exchange 2010 servers instead of Exchange 2007 "Exchange Organization Administrators" group.  <p><a name="Section2"></a> <h2>2. WSP Hosting OU ACL.</h2> <p>Exchange 2010 deployment adds a lot of new permission entries AD. That's why after you deploy Exchange 2010 in your existing WSP-managed Exchange 2007 environment, you need to reset WSP Hosting root OU permissions to default and then repeat <a href="deploying-hosted-organizations-module.html">this step</a>.  <p><a name="Section3"></a> <h2>3. Address Lists containers DACL.</h2> <p>For the same reason you reset WSP Hosting root OU permissions in previous section you should set to default all Address Lists containers DACL you changed before according to <a href="hosted-exchange-solution-pre-deployment-tasks.html">Hosted Exchange Solution Pre-deployment Tasks</a> and the repeat that steps (Modifying Address Lists Containers) again. Otherwise many system processes and administrative procedures like OAB generation will not work.  <p><a name="Section4"></a> <h2>4. New globalAddressList2 AD attribute.</h2> <p>After you create first mailbox in first Exchange 2010 organization thus creating first GAL on Exchange 2010 - it adds new globalAddressList2 attribute to CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com and populate this multi-valued attribute with newly created GAL DN. For some reasons this attribute becomes preferable (when Exchange provide clients with GALs list when they search it to check name) than normally used globalAddressList attribute of the same object. Because of this attribute is not populated with existing GALs distinguished names - adding first mailbox with WSP to mixed Exchange 2007/2010 WSP-managed organizations - this leads to "bookmark is not valid" error for existing Exchange 2007 users.  <p>More information about those attributes is here <a href="http://msdn.microsoft.com/en-us/library/cc219948(PROT.13).aspx">http://msdn.microsoft.com/en-us/library/cc219948(PROT.13).aspx</a> and here <a href="http://msdn.microsoft.com/en-us/library/cc220151(PROT.13).aspx">http://msdn.microsoft.com/en-us/library/cc220151(PROT.13).aspx</a><br>Solution is to add all existing GALs DNs that exist in globalAddressList attribute to globalAddressList2 attribute. This can be automated with LDIFDE (<a href="http://support.microsoft.com/kb/237677/en-us">http://support.microsoft.com/kb/237677/en-us</a>). Here is an example of commands that may help you to export GALs DNs from globalAddressList attribute and import them to globalAddressList2 attribute.<br><strong>Note that all this must be tested; AD should be backed up before. Please do it on your own risk.</strong></p> <p>4.1 Exporting GALs DNs from globalAddressList attribute to text file. </p> <p>LDIFDE -d "CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com" -f globalAddressList-export.txt -l globalAddressList  <p>4.2 Preparing import file.  <p>Open globalAddressList-export.txt, save as globalAddressList2-import.ldf and modify it for import looking at this <a href="http://support.microsoft.com/kb/237677/en-us">http://support.microsoft.com/kb/237677/en-us</a> article and our example.  <p>globalAddressList2-import.ldf content example:  <p>dn: CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com<br>changetype: modify<br>replace: globalAddressList2<br>globalAddressList2: CN=test01 Global Address List,CN=All Global Address Lists,CN=Address Lists Container,CN=Exchange Organization,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com<br>globalAddressList2: CN=test02 Global Address List,CN=All Global Address Lists,CN=Address Lists Container,CN=Exchange Organization,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com<br>globalAddressList2: CN=test03 Global Address List,CN=All Global Address Lists,CN=Address Lists Container,CN=Exchange Organization,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com<br>-  <p><strong>Note that "-" symbol in the end is must have one.</strong>  <p>4.3 Importing GALs DNs to globalAddressList2 attribute  <p>LDIFDE -i -f globalAddressList2-import.ldf  <p>4.4 Checking that import is OK  <p>Open ADSI edit, navigate to configuration container, open CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=hosterdomain,DC=com object and compare globalAddressList and globalAddressList2 attributes values. They should be identical.  <p><a name="Section5"></a> <h2>5. OWA 2010 may show hidden objects. </h2> <p>WSP uses this <a href="http://technet.microsoft.com/en-us/library/bb430794.aspx">http://technet.microsoft.com/en-us/library/bb430794.aspx</a> to restrict address list using with OWA clients. WSP uses Distinguished Name of Hosted Organizations Organizational Unit. It works OK for Exchange 2007 and for some Exchange 2010 implementations. But in some Exchange 2010 deployments OWA (according to our experience in deployed from the scratch, not coexisted with Exchange 2007) shows hidden objects like group created by WSP for internal purposes or some another mailbox or DL in organization which set hidden (regardless in WSP or EMS/EMS).  <p>In case this attribute set to organization GAL Distinguished Name - it works OK. In case you experience this behavior temporary workaround it to set msExchQueryBaseDN attribute manually to GAL Distinguished Name instead of OU.  <p>Appropriate WSP-created GAL name starts with Hosted Organization ID. For example if user's organization ID is ORG01, his OU is ORG01, pre-Windows 2000 name is user_org01 and GAL is org01 Global Address List.  <p>Note that you can use ADModify.net (<a href="http://technet.microsoft.com/ru-ru/library/aa996216(EXCHG.65).aspx">http://technet.microsoft.com/ru-ru/library/aa996216(EXCHG.65).aspx</a>) for bulk change of this attribute for all mailboxes in some OU (organization).  <p><a name="Section6"></a> <h2>6. WSP Exchange 2010 provider interface settings.</h2><a name="Section7"></a> <h3>Public Folder Server. </h3> <p>You can set separate mailbox server with PF database for OAB creation. In case you manage Exchange 2010 Mailbox server locally and have no separate PF server - leave this field empty. In case you manage alone 2010 mailbox server or Database Availability Group remotely - set some mailbox server name which host PF database there.  <p><a name="Section8"></a> <h3>OAB Server. </h3> <p>You can set separate mailbox server for OAB generation. In case you manage Exchange 2010 Mailbox server locally and have no separate OAB server - leave this field empty. In case you manage alone 2010 mailbox server or Database Availability Group remotely - set some mailbox server name there.  <p><a name="Section9"></a> <h3>Hub Transport Service and Client Access Service. </h3> <p>All HUB and CAS servers should have WSP Server and WSP Exchange 2010 modules deployed locally (as per Visio diagram created before) and added to main Exchange 2010 service which manages Exchange 2010 Mailbox locally or remotely.  <p><a name="Section10"></a> <h2>7. Recommended migration path from Exchange 2007 to 2010 in mixed Exchange 2007/2010 WSP-managed environment. </h2> <p><strong>Note. This instruction assume that you perform actions like informing customers about possible pause in service and made full backup of your system as well as ensure that you can restore and revert back any changes yourself.</strong>  <p>7.1 Deploy Exchange 2010 service in WSP in parallel with WSP Exchange 2007 module.  <p>7.2 Create test Virtual Server, Hosting Plan, WSP User and Hosting Space with Exchange 2010 test Hosting plan. Create Hosted Organization. Check Exchange 2010 mailbox creation. Note that you should be ready to importing GALs DNs to globalAddressList2 attribute immediately after you create this mailbox to avoid "bookmark is not valid" errors with existing Exchange 2007 users.  <p>7.3 Delete test mailbox, Hosted Organization, WSP User and Space, test Hosting Plan and Virtual Server. Do not delete Exchange 2010 service you created at step 1.  <p>7.4 Open existing Virtual Server you use and replace existing Exchange 2007 service with Exchange 2010 service you created in step 1 and tested in step 2.  <p>7.5 Create new WSP User and Hosting Space with existing Hosting Plan which is based on Virtual Server you just modify in step 4. Create new Hosted Organization in this Space, then new mailbox in this organization. Check that it is created at Exchange 2010 server. Note that you should be ready to importing GALs DNs to globalAddressList2 attribute again because in case you delete first test Exchange 2010 mailbox in step 3 globalAddressList2 attribute may be deleted and in this step recreated again.  <p>7.6 Migrate existing organization:  <p>&nbsp;&nbsp; 7.6.1 Move mailboxes for target Hosted Organization from Exchange 2007 mailbox server to Exchange 2010 mailbox server with EMC or EMS.  <p>&nbsp;&nbsp; 7.6.2 Set target Hosted Organization to use Exchange 2010 module and Mailbox database:  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.1 Open Exchange 2007 service which was just removed from Virtual Server and write down ServiceID from the browser string.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.2 Open Exchange 2010 service which was just added to Virtual Server and write down ServiceID from the browser string.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.3 Open Hosting Space which contains target Hosted Organization and write down SpaceID from the browser string.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.4 Open target Hosted Organization and write down itemID from the browser string.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.5 Open Exchange 2010 module settings (or EMC) and write down target mailbox database name.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.6.2.6 Open Microsoft SQL Server Management Studio and run the script below against WebsitePanel (WSPEnterpriseServer) database:  <p>DECLARE @Exchange2007ServiceID INT<br>DECLARE @Exchange2010ServiceID INT<br>DECLARE @SpaceID INT<br>DECLARE @OrganizationID INT<br>DECLARE @Database NVARCHAR(3000)  <p>---------------------- Place here your real values --------------------------------------<br>SET @Exchange2007ServiceID = aaa --replace with your real Exchange 2007 serviceId value<br>SET @Exchange2010ServiceID = bbb --replace with your real Exchange 2010 serviceId value<br>SET @SpaceID = ccc --replace with your real spaceId value<br>SET @OrganizationID = ddd --replace with your real itemId value<br>SET @Database = 'Mailbox Database 123456789' --replace with your real Exchange 2010 database name<br>-----------------------------------------------------------------------------------------  <p>-- update space service<br>UPDATE PackageServices<br>SET ServiceID = @Exchange2010ServiceID<br>WHERE ServiceID = @Exchange2007ServiceID<br>AND PackageID = @SpaceID  <p>-- update organization settings<br>UPDATE ServiceItemProperties<br>SET PropertyValue = @Database<br>WHERE PropertyName = 'Database'<br>AND ItemID = @OrganizationID  <p>&nbsp;&nbsp; 7.6.3 Check that you can manage existing mailboxes in target Hosted Organization as well as create new mailboxes in Exchange 2010 Mailbox database.  <p><a name="Section11"></a> <h2>8. Alternative migration/coexisting paths and their issues. </h2> <p>Recommended migration path assumes that you continue to manage your existing Exchange 2007 based organizations, while migrate them to Exchange 2010 (step 6) peacefully, one by one. All new organizations will be Exchange 2010 based. However all existing organizations will remain Exchange 2007 based (and all new mailboxes in that organizations will be Exchange 2007 based!) until procedures from step 6 done with organization. </p> <p>You may decide to choose not this migration path, but coexisting approach where existing Exchange 2007 based Virtual Server and Hosting plans set will be not changed and new Exchange 2010-based Virtual Server and Hosting plans set will be created in parallel to be able to create new organizations both Exchange 2007 and 2010 based.<br>In this case most probably you will meet issue with mailboxes in new (only new!) created Exchange 2007 organizations get "bookmark is not valid' issue. It is because Exchange 2007 GAL creation procedure does not populate globalAddressList2 attribute (but only globalAddressList attribute) with newly created organization's GAL distinguished name. That's why you may need to consider some manual or automated workflow to add new GAL's distinguished names (created by Exchange 2007 provider) to globalAddressList2 attribute. </p> <p>Sure this issue does not affect you in case you decide to deploy Exchange 2010 in new AD forest / Exchange organization. In this case migration is much more connected to r-creation of organizations and exporting-importing mailbox content.  <p><a name="Section12"></a> <h2>9. Useful links for migration/coexisting planning. </h2> <p><a href="http://technet.microsoft.com/en-us/library/dd638158.aspx">http://technet.microsoft.com/en-us/library/dd638158.aspx</a>  <p><a href="http://technet.microsoft.com/en-us/library/bb124350.aspx">http://technet.microsoft.com/en-us/library/bb124350.aspx</a>  <p><a href="http://technet.microsoft.com/en-us/library/dd351133.aspx">http://technet.microsoft.com/en-us/library/dd351133.aspx</a>  <p><a href="http://technet.microsoft.com/en-us/library/dd346708.aspx">http://technet.microsoft.com/en-us/library/dd346708.aspx</a>  <p><a href="http://technet.microsoft.com/en-us/library/ee332345.aspx">http://technet.microsoft.com/en-us/library/ee332345.aspx</a>  <p><a href="http://msexchangegeek.com/2009/09/18/get-owavirtualdirectory-returns-an-iis-directory-entry-couldnt-be-created-the-error-message-is-access-is-denied/">http://msexchangegeek.com/2009/09/18/get-owavirtualdirectory-returns-an-iis-directory-entry-couldnt-be-created-the-error-message-is-access-is-denied/</a></p>
</article></div>
        </div>
    </div>
</div>
</div>
<div id="layout-footer" class="group">
    <footer id="footer">
        <div id="footer-quad" class="group">
            <div id="footer-quad-fourth">
                <div class="zone zone-footer-quad-fourth"><article class="widget-html-widget widget">
    <center><span style="font-family: arial;" face="arial"><a href="../index.html">Home</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="../license.html">License</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="../whatsnew.html">What's new?</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="../contact-us.html">Contact Us</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="../privacy-policy/privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;&nbsp;&nbsp; <a href="../terms-of-use/terms-of-use.html">Terms of Use</a> </span></center>
</article></div>
            </div>
        </div>
        <div id="footer-sig" class="group">
            <div class="zone zone-footer">    <div class="credits"><span class="poweredby">Powered by <a href="http://www.orchardproject.net/" target="_blank">Orchard</a></span> <span class="copyright">&#169; 2011 Outercurve Foundation</span></div>
<div class="user-display">
        <span class="user-actions"><a href="../Users/Account/LogOn867b.html?ReturnUrl=%2Fexchange-2007-2010-module%2Fexchange-2010-module-deployment-and-migration-tips-and-tricks">Sign In</a></span>
</div></div>
        </div>
    </footer>
</div>
</div>

</body>

<!-- Mirrored from localhost/exchange-2007-2010-module/exchange-2010-module-deployment-and-migration-tips-and-tricks by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 12 Nov 2013 18:59:25 GMT -->
</html>